(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[422],{2346:function(e,t,n){"use strict";var a,i,r;n.d(t,"n",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"t",function(){return r}),function(e){e[e.DownloadSingleFile=0]="DownloadSingleFile",e[e.DownloadMultiFile=1]="DownloadMultiFile",e[e.DownloadFileInZip=2]="DownloadFileInZip"}(a||(a={})),function(e){e.Files="files",e.Recent="recent",e.Shared="shared",e.RecycleBin="recyclebin",e.Photos="photos"}(i||(i={})),function(e){e.Navigation="NavigationRequest",e.Click="ClickRequest",e.Search="SearchRequest",e.SearchSuggestionClick="SearchSuggestionClickRequest",e.TokenResponse="TokenResponse",e.TokenRequest="OAuthTokenRequest",e.DarkModeRequest="DarkModeRequest",e.LokiTokenRequest="LokiTokenRequest",e.SubstrateTokenRequest="SubstrateTokenRequest",e.EnablePersonalVault="EnablePersonalVault"}(r||(r={}))},3988:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return v});var a=n(0),i=n(190),r=n(55),o=n(81),s=n(126),c=n(59),d=n(204),l=n(112),u=n(256),f=n(453),p=n(91),m=n(62),_=n(381),h=n(2346),b=n(13),g=function(e){function t(t,n){void 0===t&&(t={});var a=e.call(this,t,n)||this,i=window.FilesConfig;return i&&(a._canary=i.canary,a._appId=i.appId),a._callBackIndex=0,a._graphDataSource=n.graphDataSource,a._navigation=n.navigation,a._urlDataSource=n.urlDataSource,a._userInfoDataSource=n.userInfoDataSource,a._platformDetection=n.platformDetection,a}return Object(a.__extends)(t,e),t.prototype.downloadItems=function(e){var t=e.items[0],n=this._urlDataSource;if(1===e.items.length&&t.type!==p.e.Folder)if(this._platformDetection.isMobile)this._navigation.navigateTo({url:n.getDownloadItemUrl(t,this._canary,!1),frameId:"_self"});else{var a=this._initIframe(n.getDownloadItemUrl(t,this._canary,!1));this.async.setTimeout(function(){window.document.body.removeChild(a)},2e4)}else this._downloadAsZip(e.items);return c.n.wrap()},t.prototype.getDownloadZipRequest=function(e){for(var t,n=e.items,a=this._urlDataSource.getDownloadAsZipPostUrl(n[0].ownerId,this._appId),i=[],r=0;r<n.length;r++)n[r]&&(t=n[r],i.push(t.id));if(this._userInfoDataSource.isAuthenticated()){var o,s={resIds:i.join(";"),canary:this._canary,token:""};o=1===n.length&&n[0].type===p.e.Folder?n[0].displayName+".zip":"OneDrive-"+(new Date).toLocaleDateString().replace(/\//g,"-").replace(/[^ -~]/g,"")+".zip";var d={command:"Download",type:h.n.DownloadMultiFile,downloadUrl:a,zipFileName:o,postBody:JSON.stringify({request:s})};return c.n.wrap(JSON.stringify({DownloadCommand:d}))}},t.prototype.getDownloadUrl=function(e,t){var n=!!e.video&&!!e.photo;if(e.video&&!n&&b.e.isActivated("126A864D-B398-485B-AD70-D7388DE7BA53","10/21/2021","Change video auth")){var a=new f.e,i=this._urlDataSource.getDownloadUrl(e);return a.send({apiName:"GetDownloadUrl",url:i,useDefaultHeaders:!0}).then(function(e){return e.DownloadUrl?e.DownloadUrl:c.n.wrapError(e)})}return this._graphDataSource.getDownloadUrl(e,{useDirectEndpoint:!0})},t.prototype.getDownloadRequestParameters=function(e,t){var n=this,a=t||{},r=a.allowHeaders,o=void 0===r||r,s=a.url,d=void 0===s?e.urls&&e.urls.download:s;if(!d)return c.n.reject(new Error("No URL specified"));if("https://"!==d.slice(0,8))return c.n.resolve({url:d});var l=function(){return n._graphDataSource.getDownloadUrl(e,{useDirectEndpoint:!0}).then(function(e){var t=e.indexOf("?"),n=t>=0?e.slice(0,t):e,a=d.indexOf("?"),i=a>=0?d.slice(a):"";return{url:"".concat(n).concat(i)}})};return this._graphDataSource.getAuthenticationParams(e).then(function(e){var t,n=e,a=n.access_token,r=n.authkey;if(a)return d.length+14+a.length<2e3?{url:"".concat(d,"&access_token=").concat(encodeURIComponent(a))}:o?{url:d,headers:{Authorization:"Bearer ".concat(a)}}:l();if(!a&&!r)return l();var s=d;if(r){var c=i.get("BadgerAuth");if(c){if(!o)return l();t={Authorization:"Badger ".concat(c)}}d.indexOf("authkey")<0&&(s+="&".concat("authkey","=").concat(encodeURIComponent(r)))}return{url:s,headers:t}})},t.prototype.getItemContents=function(e){return b.e.isActivated("4BB56AF7-0FFA-4E4F-90AD-E2602A13A01A","10/21/2021","Change text auth")?this.getDownloadUrl(e,{downloadType:2}).then(function(e){return(new f.e).send({apiName:"Download",url:e,returnRawXHR:!0,responseType:"blob"}).then(function(e){return e.response})}):this.getDownloadRequestParameters(e).then(function(e){return(new f.e).send({apiName:"Download",headers:e.headers,url:e.url,returnRawXHR:!0,responseType:"blob"}).then(function(e){return e.response})})},t.prototype.isDownloadBlocked=function(e){return!1},t.prototype._initIframe=function(e){var t=document.createElement("iframe");return t.src=e,t.style.display="none",window.document.body.appendChild(t),t},t.prototype._downloadAsZip=function(e){for(var t,n=this,i=0,r={},o=this._urlDataSource.getDownloadAsZipPostUrl(e[0].ownerId,this._appId),c=this._callBackIndex++,d=this._urlDataSource.getDownloadAsZipIframeUrl(this._canary),l=[],f=0;f<e.length;f++)e[f]&&(i+=(t=e[f]).size,r[t.extension]=(+r[t.extension]||0)+1,l.push(t.id));var p={fileSize:i,itemCount:l.length,extensions:r,authed:"true"};if(!this._userInfoDataSource.isAuthenticated()&&i>2147483648){var m=this._urlDataSource.getForceLoginDownloadUrl(t);this._navigation.navigateTo(m)}else{var _=Object(u.n)(d),h=Object(s.e)(Object(u.t)(d));d=_+"?"+Object(s.n)(Object(a.__assign)(Object(a.__assign)({},h),{callbackIndex:c}));var b,g="downloadAsZipIframeReady_"+c;window[g]=function(){p.url=o,p.ids=l.join(":");var e=n._urlDataSource.getAuthKeyParamValue(),t=n._urlDataSource.getTicketParamValue();b.contentWindow.startDownloadAsZip(l.join(";"),n._canary,t,e,o),n.async.setTimeout(function(){window.document.body.removeChild(b),window[g]=null},6e4)},b=this._initIframe(d)}},t.dependencies=Object(a.__assign)(Object(a.__assign)({},r.n.dependencies),{graphDataSource:m.y,navigation:o.e,platformDetection:d.e,urlDataSource:_.n,userInfoDataSource:m.Ie}),t}(r.n);t.default=g;var v=Object(l.r)("DownloadDataSource",g)}}]);