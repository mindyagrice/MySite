(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[423],{1711:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(0),i=n(1059),r=function(){function e(e,t){var n=this._pageContext=t.pageContext,r=t.tokenProvider,o=t.dataRequestorType,s=void 0===o?function(e){function t(t){return e.call(this,t,{pageContext:n,tokenProvider:r})||this}return Object(a.__extends)(t,e),t}(i.t):o,c=e.dataSourceName,d=void 0===c?"DataSource":c;this.dataRequestor=new s({qosName:d})}return e.prototype.getDataSourceName=function(){return this.dataSourceName},e.prototype.needsRequestDigest=function(e){return!0},e.prototype.getData=function(e,t,n,a,i,r,o,s,c,d,l,u,f,p){void 0===i&&(i="POST");var m=e(),_=a&&a(),h=this.needsRequestDigest(m);return this.dataRequestor.getData({url:m,parseResponse:t,qosName:n,additionalPostData:_,method:i,additionalHeaders:r,contentType:o,maxRetries:s,noRedirect:c,crossSiteCollectionCall:d,telemetryHandler:l,qosExtraData:u,needsRequestDigest:h,authToken:f,webAbsoluteUrl:p})},e}();t.t=r},1864:function(e,t,n){"use strict";n.d(t,"e",function(){return l}),n.d(t,"t",function(){return f});var a=n(59),i=n(338),r=n(120),o=n(48),s=n(106),c=n(63),d={ODB:387},l="https://graph.microsoft.com",u="DisableGraph",f=function(){function e(e,t){this._pageContext=t.pageContext,this._sharingContextInformation=t.sharingContextInformation,this._oAuthTokenProvider=t.oAuthTokenProvider,this._sharingContextInformation&&this._sharingContextInformation.additionalTokens&&(this._graphToken=this._sharingContextInformation.additionalTokens.graphToken),this.initializeDataStore()}return e.prototype.canUseGraph=function(){if(this._graphToken)return!0;if(this._pageContext&&!this._pageContext.isSPO)return!1;if(this._pageContext&&this._pageContext.authToken)return!1;var e=this._pageContext&&this._oAuthTokenProvider&&i.n.isFeatureEnabled(d);return this._dataStore&&(e=e&&!this._dataStore.getValue(u,c.e.session)),e},e.prototype.disableGraphCallsForPicker=function(){this.initializeDataStore(),this._dataStore.setValue(u,!0,c.e.session)},e.prototype.getGraphToken=function(){var e=this;if(this._graphToken)return a.n.resolve(this._graphToken);if(this._oAuthTokenProvider){var t=new r.e({name:"PeoplePicker.GetGraphToken"});return this._oAuthTokenProvider.getToken(l).then(function(e){return t.end({resultType:o.e.Success}),e},function(n){return a.n.isCanceled(n)?(t.end({resultType:o.e.ExpectedFailure,resultCode:"Canceled"}),a.n.reject(n)):(t.end({resultCode:"PeoplePicker.GetGraphTokenError",resultType:o.e.Failure,extraData:{serverErrorCode:n._serverErrorCode,message:n.message}}),e.disableGraphCallsForPicker(),null)})}return null},e.prototype.initializeDataStore=function(){this._dataStore||(this._dataStore=new s.e("PeoplePicker",c.e.session))},e}()},1869:function(e,t,n){"use strict";n.d(t,"e",function(){return u}),n.d(t,"t",function(){return p});var a=n(59),i=n(120),r=n(48),o=n(1065),s=n(106),c=n(63),d=n(338),l="DisableSubstrateSearch",u="https://outlook.office.com/search",f={ODB:1286},p=function(){function e(e,t){this._dataRequestor=new o.e({},{}),this._pageContext=t.pageContext,this._oAuthTokenProvider=t.oAuthTokenProvider,this._sharingContextInformation&&this._sharingContextInformation.additionalTokens&&(this._substrateToken=this._sharingContextInformation.additionalTokens.substrateToken),this.initializeDataStore()}return e.prototype.canUseSubstrate=function(){if(this._substrateToken)return!0;var e=!1;return this._pageContext&&!this._pageContext.isSPO||this._pageContext&&this._pageContext.authToken||(this._pageContext&&this._oAuthTokenProvider&&d.n.isFeatureEnabled(f)&&(e=!0),this._dataStore&&(e=e&&!this._dataStore.getValue(l,c.e.session))),e},e.prototype.disableSubstrateCallsForPicker=function(){this.initializeDataStore(),this._dataStore.setValue(l,!0,c.e.session)},e.prototype.getSubstrateToken=function(){var e=this;if(this._substrateToken)return a.n.resolve(this._substrateToken);if(this._oAuthTokenProvider){var t=new i.e({name:"PeoplePicker.GetSubstrateToken"});return this._oAuthTokenProvider.getToken(u).then(function(e){return t.end({resultType:r.e.Success}),e},function(n){return a.n.isCanceled(n)?(t.end({resultType:r.e.ExpectedFailure,resultCode:"Canceled"}),a.n.reject(n)):(t.end({resultCode:"PeoplePicker.GetSubstrateTokenError",resultType:r.e.Failure,extraData:{serverErrorCode:n._serverErrorCode,message:n.message}}),e.disableSubstrateCallsForPicker(),null)})}return null},e.prototype.init=function(e){var t="".concat(u,"/api/v1/init?scenario=").concat("documentshare");this._dataRequestor.send({apiName:"Substrate.PeopleSearch.Init",path:t,headers:{Authorization:"Bearer "+e},needsAuthorization:!1})},e.prototype.initializeDataStore=function(){this._dataStore||(this._dataStore=new s.e("PeoplePicker",c.e.session))},e}()},1963:function(e,t,n){"use strict";var a,i;n.d(t,"e",function(){return i}),function(e){e.Msa="msa_auth:",e.Graph="graph_auth:",e.MsaStrongAuth="msa_strong_auth:",e.PhoneLink="phone_link:"}(a||(a={})),function(e){e[e.STI=1]="STI",e[e.Default=2]="Default"}(i||(i={}))},1995:function(e,t,n){"use strict";n.d(t,"e",function(){return p});var a=n(112),i=n(2037),r=n(1083),o=n(1963),s=n(1864),c=n(1869),d=n(59),l=n(79),u=function(){function e(e,t){this._getIdentityDataSource=t.getIdentityDataSource}return e.prototype.getToken=function(e,t){return this.getInstrumentedToken(e,t).then(function(e){return e.tokenInfo.token})},e.prototype.getInstrumentedToken=function(e,t){var n=Date.now();return d.n.resolve(this._getIdentityDataSource().then(function(t){return e===s.e&&t.getGraphToken?t.getGraphToken({resource:e}):e===c.e&&t.getSubstrateToken?t.getSubstrateToken(o.e.Default):t.getOAuthSessionToken?t.getOAuthSessionToken(e):void 0}).then(function(e){var t=null==e?void 0:e.accessToken;if(!e||!t)throw new l.e({code:"UnableToResolveToken"});return{tokenInfo:{token:t,isGuest:!1,expirationTimeMs:e.tokenExpiry},spRequestId:e.correlationId||"",spRequestTimestamp:n}}))},e}(),f=Object(a.r)("OAuthTokenDataSource",u,{getIdentityDataSource:r.e.async.lazy}),p=Object(a.r)("OAuthTokenProviderBase",i.e,{oAuthTokenDataSource:f})},2037:function(e,t,n){"use strict";var a,i=n(59),r=n(120),o=n(48);!function(e){e[e.InteractionRequired=10013]="InteractionRequired"}(a||(a={}));var s=function(){function e(e,t){void 0===e&&(e={}),this._dataSource=t.oAuthTokenDataSource}return e.prototype.getToken=function(e,t){var n=new r.e({name:"getToken"});return this._dataSource.getToken(e,t).then(function(e){return n.end({resultType:o.e.Success}),e},function(e){return n.end({resultType:o.e.Failure}),i.n.reject(e)})},e.prototype.getInstrumentedToken=function(e,t){var n=new r.e({name:"getToken"});return this._dataSource.getInstrumentedToken(e,t).then(function(e){return n.end({resultType:o.e.Success}),e},function(e){return n.end({resultType:o.e.Failure}),i.n.reject(e)})},e}();t.e=s},2058:function(e,t,n){"use strict";var a=n(1995);n.d(t,"e",function(){return a.e})},2346:function(e,t,n){"use strict";var a,i,r;n.d(t,"n",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"t",function(){return r}),function(e){e[e.DownloadSingleFile=0]="DownloadSingleFile",e[e.DownloadMultiFile=1]="DownloadMultiFile",e[e.DownloadFileInZip=2]="DownloadFileInZip"}(a||(a={})),function(e){e.Files="files",e.Recent="recent",e.Shared="shared",e.RecycleBin="recyclebin",e.Photos="photos"}(i||(i={})),function(e){e.Navigation="NavigationRequest",e.Click="ClickRequest",e.Search="SearchRequest",e.SearchSuggestionClick="SearchSuggestionClickRequest",e.TokenResponse="TokenResponse",e.TokenRequest="OAuthTokenRequest",e.DarkModeRequest="DarkModeRequest",e.LokiTokenRequest="LokiTokenRequest",e.SubstrateTokenRequest="SubstrateTokenRequest",e.EnablePersonalVault="EnablePersonalVault"}(r||(r={}))},2986:function(e,t,n){"use strict";n(2987);var a=n(2058);n.d(t,"e",function(){return a.e})},2987:function(e,t){!function(e){"use strict";if(!e.fetch){var t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,a="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,r="ArrayBuffer"in e;if(r)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};m.prototype.append=function(e,t){e=u(e),t=f(t);var n=this.map[e];this.map[e]=n?n+","+t:t},m.prototype.delete=function(e){delete this.map[u(e)]},m.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},m.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},m.prototype.set=function(e,t){this.map[u(e)]=f(t)},m.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},m.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),p(e)},m.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},m.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),p(e)},n&&(m.prototype[Symbol.iterator]=m.prototype.entries);var d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},v.call(y.prototype),v.call(D.prototype),D.prototype.clone=function(){return new D(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},D.error=function(){var e=new D(null,{status:0,statusText:""});return e.type="error",e};var l=[301,302,303,307,308];D.redirect=function(e,t){if(-1===l.indexOf(t))throw new RangeError("Invalid status code");return new D(null,{status:t,headers:{location:e}})},e.Headers=m,e.Request=y,e.Response=D,e.fetch=function(e,t){return new Promise(function(n,i){var r=new y(e,t),o=new XMLHttpRequest;o.onload=function(){var e,t,a={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new m,e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),a=n.shift().trim();if(a){var i=n.join(":").trim();t.append(a,i)}}),t)};a.url="responseURL"in o?o.responseURL:a.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;n(new D(i,a))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials&&(o.withCredentials=!0),"responseType"in o&&a&&(o.responseType="blob"),r.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===r._bodyInit?null:r._bodyInit)})},e.fetch.polyfill=!0}function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function m(e){this.map={},e instanceof m?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function _(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function b(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(a&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(r&&a&&s(e))this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!r||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=_(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var e,t,n,a=_(this);if(a)return a;if(this._bodyBlob)return e=this._bodyBlob,n=h(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),a=0;a<t.length;a++)n[a]=String.fromCharCode(t[a]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(e,t){var n,a,i=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new m(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new m(t.headers)),this.method=(a=(n=t.method||this.method||"GET").toUpperCase(),d.indexOf(a)>-1?a:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function S(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),a=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(i))}}),t}function D(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new m(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},3835:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n(59),r=n(48),o=n(55),s=n(91),c=n(1057),d=n(62),l=n(204),u=n(2766),f=n(3159),p=n(81),m=n(11),_=n(8),h=n(112),b=n(308),g=n(2226),v=n(2986),y=function(e){function t(t){return e.call(this,{dataSourceName:"MicroServiceEndPointDataSource"},{pageContext:t})||this}return Object(a.__extends)(t,e),t.prototype.getMicroServiceEndPoints=function(e){var t="".concat(this._pageContext.webAbsoluteUrl,"/_api/microservicemanager/getserviceurls?service='").concat(e,"'");return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results&&e.d.GetServiceUrls.results[0]})},t.prototype.getAllMicroServiceEndPoints=function(e){var t="".concat(this._pageContext.webAbsoluteUrl,"/_api/microservicemanager/getserviceurls?service='").concat(e,"'");return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetAllServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results})},t}(n(1711).t),S=n(219),D=function(e){function t(t,n){return e.call(this,n.pageContext)||this}return Object(a.__extends)(t,e),t}(y),I=Object(h.r)("MicroserviceEndPointDataSource.key",D,{pageContext:S.s}),x=n(119),C=n(820),O=n(79),w=n(2346),E=5e3,A="od-download-tab",L=new _.t({name:"DownloadExecutor",loader:new h.t(function(){return i.n.resolve(n.e(89).then(n.bind(null,4052))).then(function(e){return e.typeResourceKey})})}),k=function(e){function t(t){var n=e.call(this,t)||this;return n._sessionManagementProvider=n.resources.consume(f.e.optional),n._platform=n.resources.consume(l.e),n._oAuthTokenProvider=n.resources.consume(v.e.optional),n._navigation=n.resources.consume(p.e),n._hiddenDomProvider=n.resources.consume(u.e),n.selectionHelper=t.selectionHelper,n.currentItem=t.currentItem,n.dialogProvider=n.resources.consume(c.e),n.isOneDriveWinApp=Object(x.e)(),n}return Object(a.__extends)(t,e),t.prototype.execute=function(e,t){var n,o=this,c=this.selectionHelper.selection;return n={items:c.peek().map(function(e){return e.peek()})},this.onPreDownloadItems(n.items).then(function(e){var c,l;return e?o.isOneDriveWinApp?(1===n.items.length&&n.items[0].type!==s.e.Folder?o.resources.consumeAsync(d.c).then(function(e){var t=n.items[0];e.getDownloadUrl(t,{downloadType:0}).then(function(e){o.resources.consumeAsync(C.e).then(function(n){var a={command:"Download",type:w.n.DownloadSingleFile,downloadUrl:e,zipFileName:t.displayName};n.sendCommand({command:JSON.stringify({DownloadCommand:a})})})})}):o.resources.consumeAsync(d.c).then(function(e){e.getDownloadZipRequest(n).then(function(e){o.resources.consumeAsync(C.e).then(function(t){t.sendCommand({command:e})})})}),{resultType:r.e.Success,extraData:(null===(c=null==t?void 0:t.data)||void 0===c?void 0:c.extraData)||{}}):o.resources.consumeAsync(d.c).then(function(e){return e.downloadItems(n).then(function(){var e,i={},o={count:n.items.length};return 1===n.items.length&&(i.fileType=s.e[n.items[0].type],i.extension=n.items[0].extension||""),{resultType:r.e.Success,extraData:Object(a.__assign)(Object(a.__assign)({},(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.extraData)||{}),i),extraMetrics:o}})}):i.n.wrap({resultType:r.e.ExpectedFailure,extraData:(null===(l=null==t?void 0:t.data)||void 0===l?void 0:l.extraData)||{}})})},t.prototype.executeVroomDownload=function(e){var n=this,a=e.itemsData,r=e.docIds,o=e.zipApiUrl,s=e.provider,c=(e.method,e.appId),d=(e.loggingEvent,e.fileDisplayName),l=e.skipAuthToken;if(!(t.doc_ids===r&&Date.now()-t.last_download<E)){t.last_download=Date.now(),t.doc_ids=r;var u=function(){return n._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:null,oAuthToken:null,appId:c,fileDisplayName:d||""})};if(a&&-1!==a[0].docId.indexOf("access_token")||"spo"===s&&this._oAuthTokenProvider)try{return i.n.resolve(this.resources.consumeAsync(I)).then(function(e){return e.getMicroServiceEndPoints("media")}).then(function(e){return n._oAuthTokenProvider.getToken(e,!0)}).then(function(e){return n._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:null,oAuthToken:e,appId:c,fileDisplayName:d||""})},u)}catch(e){return u()}return l?this._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:void 0,oAuthToken:null,appId:c,fileDisplayName:d||""}):this._sessionManagementProvider.getToken().then(function(e){return n._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:e,oAuthToken:null,appId:c,fileDisplayName:d||""})},function(e){if(e instanceof O.e&&"unauthUser"===e.code)return u()})}},t.prototype.onPreDownloadItems=function(e){return i.n.wrap(!0)},t.prototype._doDownload=function(e){var t=e.itemsData,n=e.zipApiUrl,a=e.provider,i=e.sessionToken,r=e.oAuthToken,o=e.appId,s=e.fileDisplayName;return t?this._completeDownloadasZip(t,n,a,i,r,o):this._completeDownloadFile(n,i,s)},t.prototype._completeDownloadFile=function(e,t,n){if(e+=t?"?access_token=".concat(t.accessToken):"",this.isOneDriveWinApp&&this.resources.consumeAsync(C.e).then(function(t){var a={command:"Download",type:w.n.DownloadSingleFile,downloadUrl:e,zipFileName:n};t.sendCommand({command:JSON.stringify({DownloadCommand:a})})}),this._platform.isMobile)return this._navigation.navigateTo({url:e,frameId:"_self"}),i.n.wrap({resultType:r.e.Success});if(this._platform.isIE)return this._downloadForIE(A,e),i.n.wrap({resultType:r.e.Success});var a=Math.random(),o=this._getDownloadIframe(a);return document.body.appendChild(o),o.src=e,this.async.setTimeout(function(){o.remove()},2e4),i.n.wrap({resultType:r.e.Success})},t.prototype._completeDownloadasZip=function(e,n,a,o,s,c){var d=this;t.zip_count++;var l=b.e.generate(),u="OneDrive_"+t.zip_count+"_"+(new Date).toLocaleDateString().replace(/\//g,"-").replace(/[^ -~]/g,"")+".zip";return e&&1===e.length&&(u=e[0].name+".zip"),i.n.resolve(this.resources.consumeAsync(g.e.optional)).then(function(t){var i,f=t&&t.getNotificationUrl()||"";f&&Object(m.isFeatureEnabled)(m.DownloadNotifications)&&d.resources.consumeAsync(L).then(function(e){var t=new e({items:[],guid:l,zipFileName:u});d.trackPromise(t.start()),t.wait()});var p=2e4;if(d._platform.isIE&&(i=d._downloadForIE(A),p=E),d.isOneDriveWinApp){var _={files:JSON.stringify({items:e}),notificationUrlValue:f,guid:l,provider:a,zipFileName:u,oAuthToken:s||"",accessToken:o&&o.accessToken||"",appId:c},h={command:"Download",type:w.n.DownloadMultiFile,downloadUrl:n,zipFileName:u,postBody:JSON.stringify({request:_})};return d.resources.consumeAsync(C.e).then(function(e){e.sendCommand({command:JSON.stringify({DownloadCommand:h})})}),{resultType:r.e.Success}}var b=Math.random(),g=d._getDownloadIframe(b),v=d._hiddenDomProvider.requestControl({name:"od-downloadaszip",params:{filesValue:JSON.stringify({items:e}),notificationUrlValue:f,guid:l,formAction:n,providerValue:a,id:b,zipFileName:u,target:d._platform.isIE?A:g.id,oAuthToken:s||"",accessToken:o&&o.accessToken||"",appId:c||"",resources:d.resources}}),y=document.getElementById("form_download_as_zip"+b);y.parentNode.appendChild(g),y.submit();var S=d.addDisposable({dispose:function(){d._hiddenDomProvider.disposeControl(v)}});return d.async.setTimeout(function(){S.dispose(),i&&i.close()},p),{resultType:r.e.Success}})},t.prototype._getDownloadIframe=function(e){var t=document.createElement("iframe");return t.id="od-download-iframe"+e,t.name=t.id,t.hidden=!0,t},t.prototype._downloadForIE=function(e,t){var n;return void 0===t&&(t=""),n=window.open(t,e),this.async.setTimeout(function(){n.close()},E),n},t.zip_count=0,t}(o.n),M=n(20);Object(M.n)([{rawString:".od-DownloadAsZip{visibility:hidden}"}]);var P=function(e){function t(t){var n=e.call(this,t)||this;return n.formAction=t.formAction,n.filesValue=t.filesValue,n.providerValue=t.providerValue,n.id="form_download_as_zip"+t.id,n.notificationUrlValue=t.notificationUrlValue,n.accessToken=t.accessToken,n.zipFileName=t.zipFileName,n.target=t.target,n.oAuthToken=t.oAuthToken,n.guid=t.guid,n.method=t.method||"Post",n.appId=t.appId,n}return Object(a.__extends)(t,e),t}(n(175).t),T=(n(379).e({tagName:"od-downloadaszip",template:'<div id="od-Download-As-Zip" class="od-DownloadAsZip"><form class="DownloadAsZipForm" name="form_download_as_zip" data-bind="attr:{action:formAction,target:target,id:id,method:method}"><input id="download_input_1" name="provider" type="hidden" data-bind="value:providerValue"><input id="download_input_2" name="guid" type="hidden" data-bind="value:guid"><input id="download_input_3" name="files" type="hidden" data-bind="value:filesValue"><input id="download_input_4" name="notificationUrl" type="hidden" data-bind="value:notificationUrlValue"><input id="download_input_5" name="accessToken" type="hidden" data-bind="value:accessToken"><input id="download_input_6" name="zipFileName" type="hidden" data-bind="value:zipFileName"><input id="download_input_7" name="oAuthToken" type="hidden" data-bind="value:oAuthToken"><input id="download_input_8" name="appId" type="hidden" data-bind="value:appId"></form></div>',viewModel:P,synchronous:!0}),n(1075)),U=n(3547),F=n(381),H=n(147),R=n(60),N=n(360),B=n(1061),j=n(449),V=n(127),z=n(13),G=n(678),K=n(816),W=n(114),q=n(190),Q=window.FilesConfig,Y=Q&&Q.df?"s":"p",J=z.e.isActivated("e7df0dad-1979-4300-becf-5dea50eff759","11/01/2021","Show error message for failed single file download"),X=z.e.isActivated("5E1FC4CE-E88F-4914-B62A-597B4492E3F5","11/16/2021","Handle the scenario where an error url is returned instead of download url"),Z=z.e.isActivated("65479421-487D-47E9-945F-107BE20162A3","12/28/2021","Avoid adding auth token during single file download"),$=!z.e.isActivated("C58C2206-E027-42B1-AB05-F22DD65EE474","4/25/2022","Allows migrated users to bypass the downloadAsSync Flight"),ee=!z.e.isActivated("371F4335-A870-40C0-9E49-20CF6BEBD5EC","05/13/2022","Add isZip property to extra data to distinguish download scenarios"),te=function(e){function t(t){var n=e.call(this,t)||this;return n._urlDataSource=n.resources.consume(F.n),n._identityDataSource=n.resources.consume(d.I),n._operationProvider=n.resources.consume(B.resourceKey.optional),n._clientName=n.resources.consume(K.e.optional),n}return Object(a.__extends)(t,e),t.prototype.execute=function(t,n){var o=this;return n.data.extraData||(n.data.extraData={}),ee&&(n.data.extraData=Object(a.__assign)(Object(a.__assign)({},n.data.extraData),{isZip:!1})),this.selectionHelper.resolveSelection().then(function(c){if(c){var l=o._urlDataSource.getAuthKeyParamValue(),u=c.length>1||c[0].type===s.e.Folder,f=$&&Object(W.e)(c[0].ownerId);if(u&&(Object(m.isFeatureEnabled)(m.DownloadAsZip)||f)&&!o.isOneDriveWinApp){ee&&(n.data.extraData=Object(a.__assign)(Object(a.__assign)({},n.data.extraData),{isZip:!0}));var p="",_=0,h=0,b=c.filter(function(e){return e}).map(function(e){if(e){var t=e.type===s.e.Folder;t&&h++,e.type===s.e.OneNote&&_++;var n=o._getDownloadUrl(e,t,l);return p+=n,{name:e.name+e.extension,size:e.size,docId:n,isFolder:t}}});if(H.e(n.data.extraData,{oneNotesCount:_,filesCount:c.length-h,foldersCount:h}),!b)return;var g=Q&&Q.appId,v="https://southcentralus1-media".concat(Y,".svc.ms​​​/transform/zip?cs=V2VifE9EQw==");return e.prototype.executeVroomDownload.call(o,{itemsData:b,docIds:p,zipApiUrl:v,provider:"url",method:"POST",appId:g,loggingEvent:n})}if(u||c[0].vault&&!Object(m.isFeatureEnabled)(m.UseVroomInVaultSingleFileDownload)&&!o.isOneDriveWinApp)return ee&&u&&(n.data.extraData=Object(a.__assign)(Object(a.__assign)({},n.data.extraData),{isZip:!0})),e.prototype.execute.call(o,t,n);var y=c[0].name+c[0].extension;return(o.isOneDriveWinApp?i.n.resolve({downloadUrl:o._getDownloadUrl(c[0],!1,l)}):i.n.resolve(o.resources.consumeAsync(d.y).then(function(e){var t="SingleFileDownload",n=!!q.get("BadgerAuth");return n?t="".concat(t,".PasswordProtected"):Object(m.isFeatureEnabled)(m.UseVroomInVaultSingleFileDownload)&&c[0].vault&&(t="".concat(t,".Vault")),e.getDownloadUrl(c[0],Object(a.__assign)({useDirectEndpoint:!0,apiName:t,qosExtraData:{isAuthenticated:o._identityDataSource.getIdentity().type!==N.e.anonymous,isPasswordProtected:n,fileExtension:c[0].extension||""}},Object(m.isFeatureEnabled)(m.AddTelemetryHeaders)?{headers:Object(a.__assign)({Scenario:G.e.DownloadFile,ScenarioType:G.t.ActiveUserOperation},o._clientName?{Application:o._clientName}:{})}:{}))}).then(function(e){return!X&&e.indexOf("error")>=0?{downloadUrl:e,blockDownload:!0}:{downloadUrl:e}}))).then(function(t){var a=t.downloadUrl;if(!t.blockDownload)return e.prototype.executeVroomDownload.call(o,{itemsData:null,docIds:a,zipApiUrl:a,provider:"",method:"Get",appId:"",loggingEvent:n,fileDisplayName:y||"",skipAuthToken:!Z});!J&&o._operationProvider&&o._operationProvider.register({name:c[0].displayName||"",type:j.e.downloadItem}).state(V.e.failed),R.e.log("Invalid Url - An error url was returned instead of a download url")}).catch(function(s){return R.e.log(s),Object(m.isFeatureEnabled)(m.DisableSingleFileDownloadFallback)?(o._operationProvider&&o._operationProvider.register({name:c[0].displayName||"",type:j.e.downloadItem}).state(V.e.failed),i.n.wrap({resultType:r.e.Failure,extraData:Object(a.__assign)(Object(a.__assign)({},n.data.extraData||{}),{errorStack:s.stack}),resultCode:s.name,error:"".concat(s.name,"_").concat(s.message)})):e.prototype.execute.call(o,t,n)})}}).catch(function(e){return i.n.wrap({resultType:r.e.Failure,extraData:Object(a.__assign)(Object(a.__assign)({},n.data.extraData||{}),{errorStack:e.stack}),resultCode:e.name,error:"".concat(e.name,"_").concat(e.message)})})},t.prototype.onPreDownloadItems=function(e){if(1===e.length&&e[0].type!==s.e.Folder)return i.n.wrap(!0);for(var t=107374182400,n=0,a=0,r=e.length;a<r&&n<t;a++)e[a]&&(n+=e[a].size);return n>=t?(this.resources.consume(c.e).requestDialog({title:U.e,component:{name:T.e.tagName,params:{text:""}}}),i.n.wrap(!1)):i.n.wrap(!0)},t.prototype._getDownloadUrl=function(e,t,n){var a=this._urlDataSource.getApiBaseUrl({apiVersion:"v1.0",driveId:e.ownerId}),i=e.graph&&e.graph.driveId&&e.graph.itemId?"".concat(a,"/drives/").concat(e.graph.driveId,"/items"):a+"/drive/items",r=a+"/shares",o="";if(FilesConfig.SuiteNavConfig&&FilesConfig.SuiteNavConfig.IsAuthenticated&&!n)o="".concat(i,"/").concat(e.id);else{var s="https://onedrive.live.com/redir?resid=".concat(e.id);s+=n?"&authKey=".concat(n):"",o=window.btoa(s).replace("=","").replace("+","-").replace("/","_"),o="".concat(r,"/u!").concat(o,"/root")}return o+(t?"":"/content")},t}(k);t.default=te}}]);